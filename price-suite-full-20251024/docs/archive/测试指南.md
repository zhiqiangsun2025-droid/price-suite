# 测试指南

## 🧪 测试步骤

### 方案1：测试爬虫模块（独立测试）

```bash
cd /home/user/projects/shopxo-master/apps/price-suite/server

# 运行测试脚本
python3 test_douyin_local.py
```

**测试内容**：
- ✅ 浏览器能否正常打开
- ✅ 能否自动填入邮箱和密码
- ✅ 能否点击登录
- ✅ 验证码输入是否流畅
- ✅ 截图功能是否正常
- ✅ 能否跳转到商品榜单页面
- ✅ 能否获取榜单选项（榜单类型、时间范围等）

**预期输出**：
```
============================================================
抖店爬虫测试 - 本地测试模式
============================================================

✅ 初始化浏览器...
✅ 浏览器启动成功！

🔄 开始登录抖店...
   邮箱：doudianpuhuo3@163.com
   密码：Ping99re.com

登录状态：need_code
提示信息：需要输入邮箱验证码

📸 测试截图功能...
✅ 截图成功！Base64长度：123456 字符
✅ 截图已保存：test_screenshot.png

📧 需要验证码！
请去邮箱 doudianpuhuo3@163.com 查看验证码

请输入验证码：______
```

---

### 方案2：测试完整流程（前后端集成）

#### 步骤1：启动后端服务器

```bash
cd /home/user/projects/shopxo-master/apps/price-suite/server
python3 app.py
```

**预期输出**：
```
============================================================
商品价格对比系统 - 服务器端
============================================================
数据库路径: /home/user/.../authorization.db
启动时间: 2025-10-09 12:00:00
============================================================
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5000
 * Running on http://172.19.251.155:5000
```

#### 步骤2：打开客户端

**选项A**：直接运行Python脚本
```bash
cd /home/user/projects/shopxo-master/apps/price-suite/client
python3 modern_client.py
```

**选项B**：等GitHub Actions打包完成后下载`.exe`
- 访问：https://github.com/zhiqiangsun2025-droid/price-suite/actions
- 下载最新的 `智能选品系统完整版.exe`
- 双击运行

#### 步骤3：测试登录流程

1. **打开软件**
   - ✅ 默认显示"📱 抖音罗盘登录"页面
   - ✅ 左侧显示登录表单
   - ✅ 右侧显示"登录后将显示实时页面截图"

2. **点击"🚀 开始登录"**
   - ✅ 按钮变为"登录中..."（禁用）
   - ✅ 状态变为"🔄 登录中..."（橙色）
   - ✅ 进度提示："正在连接抖店..."
   - ✅ **右侧开始显示实时截图**

3. **观察实时截图**
   - ✅ 截图每2秒更新一次
   - ✅ 可以看到登录页面的加载过程
   - ✅ 可以看到邮箱和密码被自动填入
   - ✅ 可以看到登录按钮被点击

4. **如需验证码**
   - ✅ 弹出验证码输入对话框
   - ✅ 提示："请输入邮箱验证码"
   - ✅ 说明："验证码已发送至 doudianpuhuo3@163.com"
   - ✅ 去邮箱查看验证码
   - ✅ 输入验证码，点击"✓ 确定"
   - ✅ 进度提示："正在提交验证码..."
   - ✅ **截图显示验证码提交过程**

5. **登录成功**
   - ✅ 状态变为"✅ 已登录"（绿色）
   - ✅ 按钮变为"✓ 已登录"
   - ✅ 进度提示："登录成功！现在可以进行智能选品了"
   - ✅ **弹出成功动画**：
     ```
     ┌─────────────────┐
     │       ✅        │
     │   登录成功！     │
     │ 现在可以进行     │
     │  智能选品了      │
     │                 │
     │ [继续智能选品]   │
     │     [稍后]      │
     └─────────────────┘
     ```
   - ✅ 3秒后自动关闭（或点击按钮）

6. **进入智能选品**
   - ✅ 点击"继续智能选品"
   - ✅ 自动跳转到"📊 智能选品"页面
   - ✅ 显示榜单选项（榜单类型、时间段、品类类型等）

---

## ⚠️ 可能的问题

### 问题1：后端报错 `ModuleNotFoundError: No module named 'PIL'`

**解决**：
```bash
pip3 install pillow
```

### 问题2：ChromeDriver版本不匹配

**解决**：
```bash
# 查看Chrome版本
google-chrome --version

# 下载对应版本的ChromeDriver
# 访问：https://chromedriver.chromium.org/downloads
```

### 问题3：截图不显示或报错

**可能原因**：
- 后端未启动
- 网络问题（无法连接服务器）
- 爬虫实例未创建（先登录才有截图）

**调试**：
- 查看后端日志是否有报错
- 确认`/api/douyin-screenshot`接口是否正常
- 使用`test_douyin_local.py`测试截图功能

### 问题4：元素定位失败

**症状**：
- 登录页面打开了，但没有自动填入邮箱
- 或者报错：`NoSuchElementException`

**解决**：
- 抖店页面可能改版，XPath需要更新
- 运行`test_douyin_local.py`（非headless），手动查看页面结构
- 使用浏览器开发者工具（F12）获取正确的XPath

---

## 📊 测试检查表

### 后端功能
- [ ] 服务器能否正常启动
- [ ] `/api/douyin-login-start` 接口是否正常
- [ ] `/api/douyin-submit-code` 接口是否正常
- [ ] `/api/douyin-screenshot` 接口是否正常
- [ ] 截图功能是否正常（Base64编码）
- [ ] 能否直接跳转到商品榜单URL

### 前端功能
- [ ] 首页是否显示"抖音罗盘登录"
- [ ] 登录表单是否正常显示
- [ ] 实时截图区域是否正常显示
- [ ] 点击"开始登录"后，按钮是否禁用
- [ ] 状态是否实时更新（未登录→登录中→已登录）
- [ ] 截图是否每2秒更新
- [ ] 验证码弹窗是否正常
- [ ] 登录成功动画是否显示
- [ ] "继续智能选品"按钮是否跳转到智能选品页面

### 用户体验
- [ ] 整个流程是否流畅
- [ ] 实时截图是否给人"在看直播"的感觉
- [ ] 登录成功后的引导是否清晰
- [ ] 是否有友好的错误提示

---

## 📝 测试报告模板

测试完成后，请告诉我：

1. **测试环境**：
   - 操作系统：Windows / Linux / Mac
   - Python版本：
   - Chrome版本：

2. **测试结果**：
   - ✅ 成功 / ❌ 失败

3. **遇到的问题**：
   - 问题描述：
   - 错误信息：
   - 截图（如果有）：

4. **建议优化**：
   - 哪里需要改进？
   - 有什么新想法？

---

© 2025 智能选品系统 | 等待测试反馈！

