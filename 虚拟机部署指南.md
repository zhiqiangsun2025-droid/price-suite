# 🖥️ 虚拟机部署指南

## ⚠️ 重要说明

### RPA必须在Windows上运行！

| 组件 | 可以在Linux运行吗？ | 原因 |
|------|------------------|------|
| **服务器** | ✅ 可以 | Flask是跨平台的 |
| **客户端** | ✅ 可以（但不推荐）| 主要给Windows客户用 |
| **RPA** | ❌ **不可以** | PyAutoGUI/pywinauto是Windows专用 |

**结论**: RPA必须在Windows系统运行（物理机或虚拟机）

---

## 方案对比

### 🖥️ 方案A：Windows主机 + Windows虚拟机（最常见）

```
Windows 10/11 物理机
├── 你正常工作（主机）
└── VMware Workstation
    └── Windows 10 虚拟机（RPA专用）
```

**适合**: 大多数客户（Windows用户）

---

### 🐧 方案B：Linux主机 + Windows虚拟机（你可能需要）

```
Linux 服务器/电脑
├── 运行Flask服务器
└── KVM/VirtualBox
    └── Windows 10 虚拟机（RPA专用）
```

**适合**: Linux用户、服务器环境

---

### ☁️ 方案C：云服务器 + Windows实例

```
阿里云/腾讯云
├── Linux实例（Flask服务器）
└── Windows实例（客户端+RPA）
```

**适合**: 需要24小时运行的场景

---

## 一、Windows主机安装虚拟机（方案A）

### 步骤1：下载虚拟机软件

#### 选项1：VMware Workstation（推荐）

**下载地址**: https://www.vmware.com/products/workstation-pro.html

**版本**:
- VMware Workstation 17 Pro（免费个人使用）
- 或 VMware Workstation Player（完全免费）

**安装**:
1. 双击安装包
2. 一路"下一步"
3. 输入许可证（或选择"试用"）

#### 选项2：VirtualBox（完全免费）

**下载地址**: https://www.virtualbox.org/

**安装**:
1. 双击安装包
2. 一路"下一步"

---

### 步骤2：下载Windows 10镜像

**官方下载**: https://www.microsoft.com/zh-cn/software-download/windows10

1. 点击"立即下载工具"
2. 运行工具，选择"为另一台电脑创建安装介质"
3. 选择"ISO文件"
4. 下载完成后得到 `Windows.iso`（约5GB）

---

### 步骤3：创建虚拟机

#### VMware创建步骤:

1. 打开VMware Workstation
2. 点击"创建新的虚拟机"
3. 选择"自定义（高级）"
4. 配置:

| 选项 | 值 |
|------|-----|
| **虚拟机硬件兼容性** | Workstation 17.x |
| **安装程序光盘映像文件** | 选择下载的Windows.iso |
| **操作系统** | Microsoft Windows - Windows 10 x64 |
| **虚拟机名称** | RPA工作机 |
| **位置** | D:\VMs\RPA工作机 |
| **处理器** | 2核心 |
| **内存** | 4096 MB (4GB) |
| **网络连接** | NAT |
| **硬盘大小** | 60 GB（动态分配）|

5. 点击"完成"

---

### 步骤4：安装Windows系统

1. 启动虚拟机
2. 按提示安装Windows 10
3. 设置账户（建议：账户名`rpa`，密码简单点）
4. 完成后进入桌面

---

### 步骤5：安装必要软件

在虚拟机内:

1. **安装Chrome浏览器**
   - 打开Edge，下载Chrome
   
2. **安装Python 3.8+**
   - https://www.python.org/downloads/
   - ⚠️ 勾选"Add Python to PATH"

3. **安装选品系统**
   - 复制 `智能选品系统.exe` 到虚拟机桌面
   - 双击运行，激活

4. **安装铺货软件**
   - 安装你们的铺货软件

5. **配置RPA模板**
   - 打开铺货软件
   - 截图按钮位置
   - 保存到 `templates/` 文件夹

---

### 步骤6：使用虚拟机

#### 日常使用:

```
1. 开机时，VMware自动启动虚拟机（如果设置了自启动）
2. 虚拟机在后台运行
3. 主机继续正常工作（Word/Excel/游戏等）
4. 需要查看虚拟机时，点击VMware窗口
```

#### 技巧:

**无缝模式**:
- VMware菜单 → 视图 → 无缝模式
- 虚拟机窗口就像主机窗口一样

**共享文件夹**:
- VMware菜单 → 虚拟机 → 设置 → 选项 → 共享文件夹
- 可以在主机和虚拟机之间复制文件

**快照**:
- VMware菜单 → 虚拟机 → 快照 → 拍摄快照
- 出问题时恢复到干净状态

---

## 二、Linux主机安装Windows虚拟机（方案B）

### ⚠️ 注意：需要图形界面！

RPA需要看到窗口，所以虚拟机必须有显示输出。

### 选项1：使用有图形界面的Linux（推荐）

**适合**: Ubuntu Desktop、Fedora Desktop等

#### 安装VirtualBox:

```bash
# Ubuntu/Debian
sudo apt update
sudo apt install virtualbox

# Fedora/CentOS
sudo dnf install VirtualBox
```

#### 创建虚拟机:

```bash
# 1. 下载Windows ISO
wget https://xxx/Windows10.iso

# 2. 打开VirtualBox图形界面
virtualbox

# 3. 点击"新建"，按提示创建（同上Windows步骤）
```

---

### 选项2：无图形界面Linux（服务器）

**方案**: 使用KVM + VNC远程桌面

#### 安装KVM:

```bash
# Ubuntu
sudo apt install qemu-kvm libvirt-daemon-system virtinst

# 检查
sudo systemctl status libvirtd
```

#### 创建虚拟机:

```bash
# 创建虚拟磁盘
qemu-img create -f qcow2 /var/lib/libvirt/images/rpa-win10.qcow2 60G

# 创建虚拟机
virt-install \
  --name rpa-win10 \
  --ram 4096 \
  --vcpus 2 \
  --disk path=/var/lib/libvirt/images/rpa-win10.qcow2,size=60 \
  --cdrom /path/to/Windows10.iso \
  --network network=default \
  --graphics vnc,listen=0.0.0.0,port=5900 \
  --os-variant win10
```

#### 远程访问（VNC）:

```bash
# 在你的本地电脑安装VNC客户端
# Windows: TightVNC Viewer
# Mac: RealVNC Viewer

# 连接
服务器IP:5900
```

**问题**: VNC延迟高，RPA可能不稳定

---

### 选项3：使用云桌面（推荐，如果是服务器）

**阿里云无影云桌面**:
- https://www.aliyun.com/product/wuying
- 按需付费，约 ¥0.5/小时
- 自带Windows桌面，无需自己安装虚拟机

**腾讯云GPU实例**:
- 自带Windows Server
- 按小时付费

---

## 三、配置要求对比

| 配置项 | 最低要求 | 推荐配置 | 说明 |
|--------|---------|---------|------|
| **主机CPU** | 2核 | 4核 | 支持虚拟化（Intel VT-x / AMD-V） |
| **主机内存** | 8GB | 16GB | 主机4GB + 虚拟机4GB |
| **主机硬盘** | 80GB | 120GB | 主机60GB + 虚拟机60GB |
| **虚拟机CPU** | 2核 | 2核 | RPA不需要太多CPU |
| **虚拟机内存** | 4GB | 4GB | 足够运行Win10 + Chrome |
| **虚拟机硬盘** | 40GB | 60GB | 动态分配，实际占用更少 |

---

## 四、虚拟机性能优化

### 1. 启用硬件虚拟化

**Windows主机**:
1. 重启电脑，进入BIOS（通常按F2/Delete）
2. 找到"Virtualization Technology"或"Intel VT-x"
3. 设置为"Enabled"
4. 保存退出

**Linux主机**:
```bash
# 检查是否支持虚拟化
egrep -c '(vmx|svm)' /proc/cpuinfo
# 如果返回>0，说明支持
```

### 2. 分配足够的资源

- CPU: 至少2核
- 内存: 至少4GB
- 显存: 128MB（VMware自动分配）

### 3. 使用SSD

虚拟机磁盘文件放在SSD上，速度提升明显

### 4. 关闭不必要的服务

虚拟机内:
- 关闭Windows Defender（如果不需要）
- 关闭Windows更新（设置为手动）
- 关闭视觉效果（性能优先）

---

## 五、常见问题

### Q1: Linux服务器能直接运行RPA吗？

❌ **不能！** PyAutoGUI和pywinauto是Windows专用库，Linux无法使用。

**解决方案**:
1. 在Linux服务器上运行Windows虚拟机
2. 或者使用云端Windows实例

---

### Q2: RPA能在Docker容器里运行吗？

❌ **不推荐！** 原因:
- Docker容器没有图形界面
- 无法模拟鼠标键盘
- 即使用X11转发，也不稳定

**Docker只适合运行Flask服务器，不适合RPA！**

---

### Q3: 虚拟机会影响RPA速度吗？

✅ **几乎没有影响！** 
- 虚拟机性能损耗<10%
- RPA主要受网络速度影响
- 截图和点击速度与物理机基本一致

---

### Q4: 可以一台服务器跑多个RPA虚拟机吗？

✅ **可以！** 

假设你的服务器有:
- 16核CPU
- 64GB内存
- 500GB硬盘

可以运行:
- 1个Flask服务器
- 8个Windows虚拟机（每个2核4GB）

**实现多账号同时选品铺货！**

---

### Q5: 虚拟机能自动启动吗？

✅ **可以！**

**VMware**:
1. 虚拟机 → 设置 → 选项 → 自动启动
2. 勾选"主机启动时启动虚拟机"

**VirtualBox**:
```bash
# Linux主机
systemctl enable libvirtd
virsh autostart rpa-win10
```

---

## 六、推荐方案总结

### 👤 给客户（个人用户）

**推荐**: Windows主机 + VMware Workstation Player（免费）

**步骤**:
1. 下载VMware Player
2. 下载Windows 10 ISO
3. 创建虚拟机（2核4GB）
4. 安装选品系统
5. 日常使用时虚拟机后台运行

---

### 🏢 给你（服务端部署）

#### 如果服务器是Linux:

**方案1**: Linux主机 + KVM + VNC（省钱）
- ✅ 成本低（利用现有服务器）
- ❌ 需要技术能力

**方案2**: 云端Windows实例（简单）
- ✅ 开箱即用
- ❌ 按小时付费（约¥5/小时）

#### 如果服务器是Windows:

**推荐**: 直接运行（不需要虚拟机）
- 安装选品系统
- 安装RPA依赖
- 直接运行即可

---

## 七、快速决策表

| 你的情况 | 推荐方案 | 工具 |
|---------|---------|------|
| Windows电脑，偶尔用 | 虚拟机 | VMware Player |
| Windows电脑，24小时运行 | 直接运行 | 无需虚拟机 |
| Linux桌面版 | 虚拟机 | VirtualBox |
| Linux服务器（有预算） | 云Windows | 阿里云无影 |
| Linux服务器（省钱） | KVM + VNC | libvirt |
| Mac电脑 | 虚拟机 | Parallels Desktop |

---

需要帮助？看这些文档：
1. VMware官方文档: https://docs.vmware.com/
2. VirtualBox手册: https://www.virtualbox.org/manual/
3. KVM教程: https://linux-kvm.org/

