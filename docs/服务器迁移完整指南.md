# 🚀 服务器迁移完整指南

## 📦 部署包信息

**文件**: `price-suite-server-20251024.tar.gz`  
**大小**: 36KB  
**包含**: 仅服务器端必需文件（已精简）

---

## 🎯 迁移步骤（5步搞定）

### 第1步：上传部署包到服务器

```bash
# 在本地执行（WSL或Linux）
cd /home/user/projects/shopxo-master/apps/price-suite

scp price-suite-server-20251024.tar.gz root@你的服务器IP:/opt/
```

### 第2步：解压并配置

```bash
# SSH登录服务器
ssh root@你的服务器IP

# 解压
cd /opt
tar -xzf price-suite-server-20251024.tar.gz
cd price-suite-server-20251024
```

### 第3步：安装系统依赖

```bash
# Ubuntu/Debian系统
apt-get update
apt-get install -y python3 python3-pip

# 安装Chrome（Selenium需要）
wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
apt-get install -y ./google-chrome-stable_current_amd64.deb

# 安装ChromeDriver
apt-get install -y chromium-chromedriver
```

### 第4步：启动服务

```bash
# 一键启动
./start.sh

# 验证服务
curl http://localhost:5000/
```

### 第5步：配置防火墙和域名

```bash
# 开放5000端口
ufw allow 5000

# 如果用宝塔面板
# 安全 → 防火墙 → 添加规则 → 5000端口
```

---

## 🔧 Cursor远程开发配置

### 方式1：SSH Remote Development（推荐）

**Cursor配置**：
1. 安装Remote-SSH扩展
2. 配置SSH连接：
```
Host my-server
  HostName 你的服务器IP
  User root
  Port 22
  IdentityFile ~/.ssh/id_rsa
```
3. Cursor → 左下角 → Remote-SSH → Connect to Host
4. 选择 `my-server`
5. 打开目录：`/opt/price-suite-server-20251024`

**优势**：
- ✅ 直接在服务器编辑代码
- ✅ 实时测试
- ✅ 无需来回传输

### 方式2：Git同步开发

**本地开发**：
```bash
# 在WSL/Linux开发
cd /home/user/projects/shopxo-master/apps/price-suite
vim server/app.py

# 提交
git add server/
git commit -m "更新服务器代码"
git push origin main
```

**服务器同步**：
```bash
# 在服务器执行
cd /opt/price-suite-server-20251024
git pull origin main

# 重启服务
./stop.sh && ./start.sh
```

### 方式3：SFTP自动同步

**Cursor配置**：
```json
// .vscode/sftp.json
{
    "name": "My Server",
    "host": "你的服务器IP",
    "protocol": "sftp",
    "port": 22,
    "username": "root",
    "remotePath": "/opt/price-suite-server-20251024/server",
    "uploadOnSave": true,
    "ignore": [
        "**/__pycache__",
        "**/*.pyc",
        "**/.venv"
    ]
}
```

---

## 📂 部署包内容清单

```
price-suite-server-20251024/
├── server/
│   ├── app.py                      # Flask主程序
│   ├── douyin_scraper_v2.py        # 抖音爬虫V2
│   ├── douyin_scraper.py           # 抖音爬虫V1
│   ├── ai_matcher.py               # AI匹配
│   ├── admin_tool.py               # 管理工具
│   ├── web_auto_listing.py         # 网页自动上货
│   ├── app_listing_api.py          # 上货API
│   ├── requirements.txt            # Python依赖
│   ├── templates/                  # HTML模板
│   └── static/                     # 静态文件
├── start.sh                        # 启动脚本
├── stop.sh                         # 停止脚本
└── README.md                       # 部署说明
```

---

## ⚙️ 服务器配置

### 推荐配置
```
CPU: 2核+
内存: 2GB+（Selenium需要内存）
硬盘: 20GB+
系统: Ubuntu 20.04/22.04
```

### 端口使用
```
5000: Flask主服务
（可选）80/443: Nginx反向代理
```

### 环境变量（可选）
```bash
# 在服务器添加
export PRICE_SUITE_SERVER_URL="http://your-domain.com:5000"
export ADMIN_PASSWORD="你的管理员密码"
```

---

## 🌐 配置客户端连接服务器

### 方式1：修改配置文件（客户操作）

客户下载EXE后，在同目录创建 `config_client.json`：
```json
{
  "server_url": "http://你的服务器IP:5000"
}
```

### 方式2：重新打包（你操作）

修改 `client/config_client.json` 的默认服务器地址：
```json
{
  "server_url": "http://你的实际服务器IP:5000"
}
```

然后重新打包EXE，客户下载后默认连接你的服务器。

---

## 🔐 安全建议

### 1. 使用Nginx反向代理
```nginx
# /etc/nginx/sites-available/price-suite
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://127.0.0.1:5000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

### 2. 配置HTTPS（生产必须）
```bash
# 使用Let's Encrypt免费证书
apt-get install -y certbot python3-certbot-nginx
certbot --nginx -d your-domain.com
```

### 3. 限制访问（可选）
```python
# server/app.py
# 添加IP白名单验证
```

---

## 🐛 常见问题

### Q1: 启动后无法访问
```bash
# 检查服务是否运行
ps aux | grep python
netstat -tulpn | grep 5000

# 查看日志
tail -f server/error.log
```

### Q2: Selenium失败
```bash
# 检查Chrome是否安装
google-chrome --version

# 安装ChromeDriver
pip3 install webdriver-manager
```

### Q3: 数据库权限
```bash
# 确保数据库文件可写
chmod 666 server/authorization.db
```

---

## 📊 迁移后验证清单

```
□ 服务器可访问（curl http://IP:5000）
□ 客户端能连接服务器
□ 抖音登录功能正常
□ 选品功能正常
□ 网页自动上货功能正常
□ 日志正常记录
□ 数据库正常读写
```

---

## 🔄 后续开发流程

### Cursor远程开发（推荐）
```
1. Cursor连接到服务器（SSH）
2. 直接编辑服务器上的代码
3. 保存后自动生效
4. 实时查看日志调试
```

### Git同步开发
```
1. 本地修改 → git push
2. 服务器 → git pull
3. 重启服务 → ./stop.sh && ./start.sh
```

---

## 📞 技术支持

部署遇到问题可查看：
- 服务器日志：`server/error.log`
- Flask日志：`server/app.log`
- 系统日志：`/var/log/syslog`

---

**现在可以开始迁移了！** 🚀

