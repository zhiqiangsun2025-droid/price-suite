# æ™ºèƒ½é€‰å“ç³»ç»Ÿ - æµ‹è¯•æ–‡æ¡£

## ğŸ“‹ æ¦‚è¿°

æœ¬é¡¹ç›®åŒ…å«ä¸‰å±‚æµ‹è¯•ä½“ç³»ï¼š
1. **å•å…ƒæµ‹è¯•**ï¼šæµ‹è¯•ç‹¬ç«‹å‡½æ•°å’Œå·¥å…·æ–¹æ³•
2. **é›†æˆæµ‹è¯•**ï¼šæµ‹è¯•GUIç»„ä»¶å’Œå®Œæ•´å·¥ä½œæµ
3. **EXEè‡ªåŠ¨åŒ–æµ‹è¯•**ï¼šæµ‹è¯•æ‰“åŒ…åçš„å¯æ‰§è¡Œæ–‡ä»¶

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### Windows

```batch
# è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆå•å…ƒ+EXEï¼‰
run_tests.bat

# ä»…è¿è¡Œå•å…ƒæµ‹è¯•
pytest tests/ -v
```

### Linux/Mac

```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
./run_tests.sh

# æˆ–æ‰‹åŠ¨è¿è¡Œ
pytest tests/ -v --cov=. --cov-report=html
```

---

## ğŸ“¦ ç¯å¢ƒå‡†å¤‡

### 1. å®‰è£…ç³»ç»Ÿä¾èµ–ï¼ˆLinux/WSLï¼‰

**å¦‚æœåœ¨Linuxæˆ–WSLç¯å¢ƒä¸‹è¿è¡Œæµ‹è¯•ï¼Œéœ€è¦å…ˆå®‰è£…tkinterï¼š**

```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install -y python3-tk tk-dev

# CentOS/RHEL
sudo yum install -y python3-tkinter tk-devel

# Arch Linux
sudo pacman -S tk
```

**æ³¨æ„**ï¼šæœ¬é¡¹ç›®å·²åœ¨æµ‹è¯•æ¡†æ¶ä¸­å†…ç½®GUIæ¨¡å—Mockï¼Œå³ä½¿ä¸å®‰è£…tkinterä¹Ÿèƒ½è¿è¡Œå•å…ƒæµ‹è¯•ã€‚ä½†ä¸ºäº†æ›´å¥½çš„å…¼å®¹æ€§ï¼Œå»ºè®®å®‰è£…ã€‚

### 2. å®‰è£…æµ‹è¯•ä¾èµ–

```bash
# å•å…ƒæµ‹è¯•ä¾èµ–
pip install -r requirements_test.txt

# å®¢æˆ·ç«¯è¿è¡Œæ—¶ä¾èµ–ï¼ˆæµ‹è¯•æ—¶éœ€è¦ï¼‰
pip install customtkinter requests pillow pandas openpyxl cryptography pyperclip

# EXEæµ‹è¯•ä¾èµ–ï¼ˆä»…Windowsï¼‰
pip install -r requirements_test_exe.txt
```

### 3. ä¸€é”®å®‰è£…ï¼ˆæ¨èï¼‰

**Linux/WSLï¼š**
```bash
# è¿è¡Œä¾¿æ·å®‰è£…è„šæœ¬
./setup-test-env.sh
```

**Windowsï¼š**
```bash
# å®‰è£…æ‰€æœ‰ä¾èµ–
pip install -r requirements_test.txt
pip install customtkinter requests pillow pandas openpyxl cryptography pyperclip
```

### 4. é…ç½®æµ‹è¯•ç¯å¢ƒ

åˆ›å»º `config_client.json`ï¼ˆå¯é€‰ï¼Œç”¨äºæµ‹è¯•é…ç½®è§£æï¼‰ï¼š

```json
{
  "server_url": "http://127.0.0.1:5000"
}
```

---

## ğŸ§ª è¿è¡Œæµ‹è¯•

### å•å…ƒæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•
pytest tests/ -v

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
pytest tests/test_config.py -v

# è¿è¡Œç‰¹å®šæµ‹è¯•ç”¨ä¾‹
pytest tests/test_utils.py::TestHardwareID::test_hardware_id_format -v

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
pytest tests/ --cov=. --cov-report=html
```

### EXEè‡ªåŠ¨åŒ–æµ‹è¯•

```bash
# å‰æï¼šå…ˆæ„å»ºEXE
pyinstaller modern_client_ultimate.py

# è¿è¡ŒEXEæµ‹è¯•ï¼ˆä»…Windowsï¼‰
pytest tests_exe/ -v

# è¿è¡Œç‰¹å®šEXEæµ‹è¯•
pytest tests_exe/test_exe_startup.py -v
```

### å¸¦æ ‡è®°çš„æµ‹è¯•

```bash
# ä»…è¿è¡Œå•å…ƒæµ‹è¯•
pytest -m unit

# ä»…è¿è¡Œé›†æˆæµ‹è¯•
pytest -m integration

# è·³è¿‡æ…¢é€Ÿæµ‹è¯•
pytest -m "not slow"
```

---

## ğŸ“Š æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š

### è¦†ç›–ç‡æŠ¥å‘Š

è¿è¡Œæµ‹è¯•åï¼Œæ‰“å¼€ `htmlcov/index.html` æŸ¥çœ‹è¯¦ç»†è¦†ç›–ç‡æŠ¥å‘Šã€‚

```bash
# Windows
start htmlcov/index.html

# Linux
xdg-open htmlcov/index.html

# Mac
open htmlcov/index.html
```

### æµ‹è¯•å¤±è´¥æˆªå›¾

EXEæµ‹è¯•å¤±è´¥æ—¶ï¼Œæˆªå›¾è‡ªåŠ¨ä¿å­˜åœ¨ `screenshots/` ç›®å½•ã€‚

---

## ğŸ”§ æµ‹è¯•é…ç½®

### pytest.ini

```ini
[pytest]
testpaths = tests
addopts = -v --strict-markers --tb=short
markers =
    unit: å•å…ƒæµ‹è¯•
    integration: é›†æˆæµ‹è¯•
    slow: æ…¢é€Ÿæµ‹è¯•
    gui: GUIæµ‹è¯•
```

### .coveragerc

é…ç½®ä»£ç è¦†ç›–ç‡ç»Ÿè®¡è§„åˆ™ï¼Œæ’é™¤æµ‹è¯•æ–‡ä»¶ã€å¤‡ä»½æ–‡ä»¶ç­‰ã€‚

---

## ğŸ“ æµ‹è¯•ç›®å½•ç»“æ„

```
client/
â”œâ”€â”€ tests/                      # å•å…ƒ/é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py            # pytesté…ç½®å’Œfixtures
â”‚   â”œâ”€â”€ test_config.py         # é…ç½®è§£ææµ‹è¯•
â”‚   â”œâ”€â”€ test_utils.py          # å·¥å…·å‡½æ•°æµ‹è¯•
â”‚   â”œâ”€â”€ test_api_client.py     # APIè°ƒç”¨æµ‹è¯•ï¼ˆMockï¼‰
â”‚   â”œâ”€â”€ test_gui_components.py # GUIç»„ä»¶æµ‹è¯•
â”‚   â””â”€â”€ test_workflows.py      # ç«¯åˆ°ç«¯å·¥ä½œæµæµ‹è¯•
â”‚
â”œâ”€â”€ tests_exe/                  # EXEè‡ªåŠ¨åŒ–æµ‹è¯•
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ conftest.py
â”‚   â”œâ”€â”€ test_exe_startup.py    # EXEå¯åŠ¨æµ‹è¯•
â”‚   â”œâ”€â”€ test_exe_login.py      # ç™»å½•äº¤äº’æµ‹è¯•
â”‚   â”œâ”€â”€ test_exe_navigation.py # é¡µé¢å¯¼èˆªæµ‹è¯•
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ gui_automation.py  # pywinautoå°è£…
â”‚       â””â”€â”€ screenshot_compare.py
â”‚
â”œâ”€â”€ pytest.ini                  # pytesté…ç½®
â”œâ”€â”€ .coveragerc                 # è¦†ç›–ç‡é…ç½®
â”œâ”€â”€ requirements_test.txt       # å•å…ƒæµ‹è¯•ä¾èµ–
â”œâ”€â”€ requirements_test_exe.txt   # EXEæµ‹è¯•ä¾èµ–
â”œâ”€â”€ run_tests.bat              # Windowsæµ‹è¯•è„šæœ¬
â””â”€â”€ run_tests.sh               # Linux/Macæµ‹è¯•è„šæœ¬
```

---

## ğŸ¯ æµ‹è¯•è¦†ç›–èŒƒå›´

### å•å…ƒæµ‹è¯• (tests/)

#### test_config.py
- âœ… ç¯å¢ƒå˜é‡ä¼˜å…ˆçº§æµ‹è¯•
- âœ… config_client.jsonè¯»å–æµ‹è¯•
- âœ… é»˜è®¤å€¼å›è½æµ‹è¯•
- âœ… JSONè§£æå¤±è´¥å®¹é”™æµ‹è¯•
- âœ… ç©ºå€¼å¤„ç†æµ‹è¯•
- âœ… é…ç½®è·¯å¾„ç”Ÿæˆæµ‹è¯•

#### test_utils.py
- âœ… ç¡¬ä»¶IDæ ¼å¼éªŒè¯
- âœ… ç¡¬ä»¶IDä¸€è‡´æ€§æµ‹è¯•
- âœ… å®¢æˆ·ç«¯IDç”Ÿæˆæµ‹è¯•
- âœ… å®¢æˆ·ç«¯IDå”¯ä¸€æ€§æµ‹è¯•
- âœ… é…ç½®æ–‡ä»¶è¯»å†™æµ‹è¯•
- âœ… ä¸»é¢˜é¢œè‰²å®šä¹‰æµ‹è¯•

#### test_api_client.py
- âœ… æ³¨å†ŒAPIæµ‹è¯•ï¼ˆæˆåŠŸ/å¤±è´¥/è¶…æ—¶ï¼‰
- âœ… æˆæƒéªŒè¯æµ‹è¯•ï¼ˆ403/æˆåŠŸï¼‰
- âœ… ç™»å½•APIæµ‹è¯•ï¼ˆéœ€è¦éªŒè¯ç /ç›´æ¥æˆåŠŸï¼‰
- âœ… éªŒè¯ç æäº¤æµ‹è¯•
- âœ… æˆªå›¾è½®è¯¢æµ‹è¯•
- âœ… çˆ¬å–APIæµ‹è¯•

#### test_gui_components.py
- âœ… é¡µé¢åˆ‡æ¢é€»è¾‘æµ‹è¯•
- âœ… é¡µé¢åˆ‡æ¢å»æŠ–æµ‹è¯•
- âœ… èœå•é«˜äº®æ›´æ–°æµ‹è¯•
- âœ… é”™è¯¯æç¤ºä¸è·³é¡µæµ‹è¯•
- âœ… ç™»å½•çŠ¶æ€ç®¡ç†æµ‹è¯•
- âœ… è¯•ç”¨å€’è®¡æ—¶æµ‹è¯•
- âœ… ç‰ˆæœ¬å·æ˜¾ç¤ºæµ‹è¯•

#### test_workflows.py
- âœ… å®Œæ•´ç”¨æˆ·æµç¨‹æµ‹è¯•ï¼ˆæ³¨å†Œâ†’ç™»å½•â†’é€‰å“â†’å¯¼å‡ºï¼‰
- âœ… å¼‚å¸¸åœºæ™¯æµ‹è¯•ï¼ˆæœåŠ¡å™¨ä¸å¯è¾¾ã€æˆæƒè¿‡æœŸã€è¯•ç”¨æœŸç»“æŸï¼‰
- âœ… çŠ¶æ€æŒä¹…åŒ–æµ‹è¯•
- âœ… RPAé›†æˆæµ‹è¯•
- âœ… æ€§èƒ½åŸºå‡†æµ‹è¯•

### EXEè‡ªåŠ¨åŒ–æµ‹è¯• (tests_exe/)

#### test_exe_startup.py
- âœ… EXEå¯åŠ¨æµ‹è¯•
- âœ… çª—å£æ ‡é¢˜éªŒè¯
- âœ… å·¦ä¾§èœå•å¯è§æ€§æµ‹è¯•
- âœ… é»˜è®¤é¡µé¢éªŒè¯
- âœ… å¯åŠ¨æ€§èƒ½æµ‹è¯•

#### test_exe_navigation.py
- âœ… å¯¼èˆªåˆ°å„é¡µé¢æµ‹è¯•
- âœ… è¿”å›ç™»å½•é¡µæµ‹è¯•
- âœ… å¤šæ¬¡é¡µé¢åˆ‡æ¢æµ‹è¯•
- âœ… é¡µé¢åˆ‡æ¢æ€§èƒ½æµ‹è¯•

#### test_exe_login.py
- âœ… ç™»å½•è¡¨å•å­˜åœ¨æ€§æµ‹è¯•
- â¸ï¸ ç™»å½•å‡­è¯å¡«å……æµ‹è¯•ï¼ˆéœ€MockæœåŠ¡å™¨ï¼‰
- â¸ï¸ ç™»å½•æŒ‰é’®ç‚¹å‡»æµ‹è¯•ï¼ˆéœ€MockæœåŠ¡å™¨ï¼‰
- âœ… å®æ—¶é¢„è§ˆåŒºåŸŸæµ‹è¯•

---

## âš™ï¸ é«˜çº§ç”¨æ³•

### MockæœåŠ¡å™¨

ä½¿ç”¨ `responses` åº“Mock APIå“åº”ï¼š

```python
import responses

@responses.activate
def test_api_call():
    responses.add(
        responses.POST,
        'http://127.0.0.1:5000/api/register',
        json={'success': True, 'client_id': 'test'},
        status=200
    )
    
    # æµ‹è¯•ä»£ç ...
```

### è‡ªå®šä¹‰Fixtures

åœ¨ `conftest.py` ä¸­æ·»åŠ ï¼š

```python
@pytest.fixture
def custom_config():
    return {'key': 'value'}

def test_something(custom_config):
    assert custom_config['key'] == 'value'
```

### å‚æ•°åŒ–æµ‹è¯•

```python
@pytest.mark.parametrize("input,expected", [
    ("test1", "result1"),
    ("test2", "result2"),
])
def test_multiple_cases(input, expected):
    assert process(input) == expected
```

---

## ğŸ› è°ƒè¯•å¤±è´¥æµ‹è¯•

### æŸ¥çœ‹è¯¦ç»†è¾“å‡º

```bash
# æ˜¾ç¤ºprintè¾“å‡º
pytest -s

# æ˜¾ç¤ºè¯¦ç»†å›æº¯
pytest --tb=long

# åœ¨ç¬¬ä¸€ä¸ªå¤±è´¥å¤„åœæ­¢
pytest -x

# è¿›å…¥è°ƒè¯•å™¨
pytest --pdb
```

### æŸ¥çœ‹è¦†ç›–ç‡æœªè¾¾æ ‡çš„ä»£ç 

```bash
# ç”ŸæˆæŠ¥å‘ŠåæŸ¥çœ‹
pytest --cov=. --cov-report=term-missing
```

---

## ğŸ“ˆ è¦†ç›–ç‡ç›®æ ‡

- **å·¥å…·å‡½æ•°**ï¼šâ‰¥90%
- **é…ç½®é€»è¾‘**ï¼šâ‰¥85%
- **APIå®¢æˆ·ç«¯**ï¼šâ‰¥80%
- **GUIç»„ä»¶**ï¼šâ‰¥60%ï¼ˆCustomTkinteréš¾ä»¥å®Œå…¨Mockï¼‰

---

## ğŸ”— CI/CDé›†æˆ

### GitHub Actions

æµ‹è¯•å·²é›†æˆåˆ° `.github/workflows/build-windows.yml`ï¼š

- æ¯æ¬¡æ¨é€è‡ªåŠ¨è¿è¡Œå•å…ƒæµ‹è¯•
- æ„å»ºEXEåè¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•
- ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Šå¹¶ä¸Šä¼ 
- æµ‹è¯•å¤±è´¥æ—¶ä¿å­˜æˆªå›¾

---

## â“ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆEXEæµ‹è¯•åœ¨Linuxä¸Šè·³è¿‡ï¼Ÿ
A: EXEæµ‹è¯•ä¾èµ–pywinautoï¼Œä»…æ”¯æŒWindowsã€‚Linuxä¸Šä¼šè‡ªåŠ¨è·³è¿‡ã€‚

### Q: å¦‚ä½•åŠ å¿«æµ‹è¯•é€Ÿåº¦ï¼Ÿ
A: ä½¿ç”¨ `pytest -n auto` å¯ç”¨å¹¶è¡Œæµ‹è¯•ï¼ˆéœ€å®‰è£…pytest-xdistï¼‰ã€‚

### Q: æµ‹è¯•å¤±è´¥æ€ä¹ˆåŠï¼Ÿ
A: æŸ¥çœ‹ `htmlcov/index.html` å®šä½æœªè¦†ç›–ä»£ç ï¼Œæˆ–æŸ¥çœ‹ `screenshots/` ç›®å½•çš„å¤±è´¥æˆªå›¾ã€‚

### Q: å¦‚ä½•æ·»åŠ æ–°æµ‹è¯•ï¼Ÿ
A: åœ¨ `tests/` ç›®å½•åˆ›å»º `test_*.py` æ–‡ä»¶ï¼Œpytestä¼šè‡ªåŠ¨å‘ç°ã€‚

---

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- [GitHub Issues](https://github.com/zhiqiangsun2025-droid/price-suite/issues)
- [æµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š](htmlcov/index.html)

---

*æœ€åæ›´æ–°: 2025-10-12*

