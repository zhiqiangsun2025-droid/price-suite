name: è‡ªåŠ¨åŒ–æµ‹è¯•

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  unit-tests:
    name: å•å…ƒæµ‹è¯•
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
    
    - name: ğŸ è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
        cache: 'pip'
    
    - name: ğŸ“¦ å®‰è£…æµ‹è¯•ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install pytest pytest-cov pytest-mock
        pip install requests pandas openpyxl
    
    - name: ğŸ§ª è¿è¡Œå•å…ƒæµ‹è¯•
      run: |
        cd client
        pytest tests/test_utils.py tests/test_config.py -v --cov=. --cov-report=xml
      continue-on-error: true
    
    - name: ğŸ“Š ä¸Šä¼ æµ‹è¯•è¦†ç›–ç‡
      uses: codecov/codecov-action@v3
      with:
        files: ./client/coverage.xml
        flags: unittests
      continue-on-error: true

  integration-tests:
    name: é›†æˆæµ‹è¯•
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
    
    - name: ğŸ è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: ğŸ“¦ å®‰è£…ä¾èµ–
      run: |
        python -m pip install --upgrade pip
        pip install pytest requests pandas
    
    - name: ğŸ§ª è¿è¡Œé›†æˆæµ‹è¯•
      run: |
        cd client
        pytest tests/test_api_client.py -v
      continue-on-error: true

  code-quality:
    name: ä»£ç è´¨é‡æ£€æŸ¥
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ æ£€å‡ºä»£ç 
      uses: actions/checkout@v3
    
    - name: ğŸ è®¾ç½®Pythonç¯å¢ƒ
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: ğŸ“¦ å®‰è£…æ£€æŸ¥å·¥å…·
      run: |
        python -m pip install --upgrade pip
        pip install flake8 pylint
    
    - name: ğŸ” ä»£ç é£æ ¼æ£€æŸ¥
      run: |
        flake8 client/modern_client_ultimate.py --max-line-length=120 --ignore=E501,W503
      continue-on-error: true
    
    - name: âœ… æµ‹è¯•å®Œæˆ
      run: echo "æ‰€æœ‰æµ‹è¯•å·²å®Œæˆ"

